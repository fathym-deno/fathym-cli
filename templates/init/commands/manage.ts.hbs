import { z } from 'zod';
import {
  type CommandContext,
  CommandParams,
  CommandRuntime,
  defineCommandModule,
} from '@fathym/cli';

// ðŸ§© Define schemas
const ManageFlagsSchema = z.object({
  verbose: z.boolean().optional().describe('Show detailed output'),
  'dry-run': z
    .boolean()
    .optional()
    .describe('Show what would be done without doing it'),
});

const ManageArgsSchema = z.tuple([]);

// ðŸ§© Parameter class
class ManageCommandParams extends CommandParams<
  z.infer<typeof ManageArgsSchema>,
  z.infer<typeof ManageFlagsSchema>
> {
  get Verbose(): boolean {
    return this.Flag('verbose') ?? false;
  }
}

// ðŸš€ Command logic
export class ManageCommand extends CommandRuntime<ManageCommandParams> {
  public Run(ctx: CommandContext<ManageCommandParams>): Promise<void> {
    const { Verbose, DryRun } = ctx.Params;
    const { Log } = ctx;

    if (DryRun) {
      Log.Info('ðŸ›‘ Dry run: Would show management status');
    } else {
      Log.Info('ðŸ“Š Showing management status...');
      if (Verbose) {
        Log.Info('   Detailed view enabled');
      }
    }

    return Promise.resolve();
  }

  public BuildMetadata() {
    return this.buildMetadataFromSchemas(
      'manage',
      'Show management status and options.',
      ManageArgsSchema,
      ManageFlagsSchema
    );
  }
}

export default defineCommandModule({
  FlagsSchema: ManageFlagsSchema,
  ArgsSchema: ManageArgsSchema,
  Params: ManageCommandParams,
  Command: ManageCommand,
});
